<h1><code ng:non-bindable=""></code>
<span class="hint"></span>
</h1>
<div><h1 id="pluralization">Pluralization</h2>

<p>Wow we've come far! We learned all about the different components angular-translate
provides, we know how to introduce many translation tables at a time, we also
made use of different kind of storages to let our app remember the language over
cross http requests and last but not least, we used asynchronous loaders, to
loader our translation data asynchronously from a server! Wow!</p>

<p>But there's still a thing we haven't talked about yet: <strong>pluralization</strong>. Pluralization
is a pretty hard topic when it comes to localization and internationalization.
Different languages and cultures use different interpretations of how a language
behaves in certain situations. Fortunately, there is a
<a href="http://userguide.icu-project.org/formatparse/messages">standard</a> that specifies
all that kind of stuff. However, this doesn't change the fact that its hard to
implement.</p>

<p><a href="https://github.com/SlexAxton">Alex Sexton</a> did the job and built a JavaScript
library that implements the <em>ICU User Guide</em> spec. It's called MessageFormat and
you can find it right <a href="https://github.com/SlexAxton/messageformat.js">here</a>.</p>

<h3 id="angulartranslatemeetsmessageformat">angular-translate meets MessageFormat</h4>

<p>We thought, the best way to bring pluralization to angular-translate, is to adapt
the functionality of MessageFormat, since it solves all the problems including
<a href="https://github.com/SlexAxton/messageformat.js#simple-variable-replacement">simple variable replacement</a>,
<a href="https://github.com/SlexAxton/messageformat.js#selectformat">SelectFormat</a>,
and <a href="https://github.com/SlexAxton/messageformat.js#pluralformat">PluralFormat</a>.
So, how can we use MessageFormat with angular-translate to use its full functionality
within our apps?</p>

<p>Of course, there is a corresponding extension for it. Simply install the MessageFormat
interpolation service via Bower like this:</p>

<pre><code>$ bower install angular-translate-interpolation-messageformat
</code></pre>

<p>Okay, easy. Not embed it in your HTML document, so we have access to the provided
service. Don't forget to embed MessageFormat.js itself first:</p>

<pre class="prettyprint linenums">
&lt;script src="path/to/messageformat.js"&gt;&lt;/script&gt;
&lt;script src="path/to/angular-translate-interpolation-messageformat"&gt;&lt;/script&gt;
</pre>

<p>Once everything is there, we can use <code>$translateProvider</code> to tell angular-translate
to use the MessageFormat interpolation, instead of the default interpolation.
<code>$translateProvider</code> provides a method called <code>useMessageFormatInterpolation()</code>
which does the trick. We also have to use <code>$translateProvider.preferredLanguage()</code>
again, to let MessageFormat know, which locale to use for
<a href="https://github.com/SlexAxton/messageformat.js#named-keys">named keys</a>.</p>

<pre class="prettyprint linenums">
$translateProvider.useMessageFormatInterpolation();
$translateProvider.preferredLanguage('en');
</pre>

<p>That's basically it! Your app now uses MessageFormat to interpolate your translations
against possible values. So what does that mean? Since you are now relying on
MessageFormat interpolation rather then default interpolation, you can now use
the syntax MessageFormat.js expects to interpolate your translations.</p>

<p>Let's take some of MessageFormat's examples provided in it's README file. This is
how some translations could look like:</p>

<pre><code>{
  "LIKE_TEXT": "{GENDER, select, male{He} female{She} other{They}} liked this."
}
</code></pre>

<p>As you can see, MessageFormat supports <code>SelectFormat</code> to interpolate texts depending
on a given gender for example. We can use <code>$translate</code> service, as well as
<code>translate</code> directive an filter, to translate the <code>LIKE_TEXT</code> translation id, like
we always did:</p>

<pre class="prettyprint linenums">
// using `$translate` service
$translate('LIKE_TEXT', { GENDER: 'male' });
// using `translate` filter
{{ 'LIKE_TEXT' | translate:"{ GENDER: 'male' }" }}
// using `translate` directive
&lt;ANY translate="LIKE_TEXT" translate-values="{ GENDER: 'male' }"&gt;&lt;/ANY&gt;
</pre>

<p>Is that cool? You can just plug MessageFormat's functionality onto angular-translate
and use high level pluralization within your translations!</p>

<h3 id="thedrawback">The drawback</h4>

<p>Actually it's pretty cool that we are able to use MessageFormat as our interpolation
engine. Unfortunately, when replacing MessageFormat interpolation with angular-translate's
default interpolation, there's a big problem. Take a look at the following code,
do you see any differents?</p>

<pre><code>{
  "DEFAULT_INTERPOLATION": "This is a translation that uses default interpolation with a dynamic value: {{value}}",
  "MF_INTERPOLATION": "This is a translation that uses MessageFormat interpolation with a dynamic value: {value}"
}
</code></pre>

<p>Exactly. MessageFormat uses a different syntax for its interpolation. This means,
when using MessageFormat interpolation, you have to rock over all of your translations,
check if they use any kind of variable replacement and update them to match the
right interpolation syntax. This isn't a cool thing.</p>

<p>In addition to that, we are also loosing all of Angular's cool features like
expression evaluation or the use of filters, since MessageFormat just don't support
them. So, how do we get around this? We need a way to use angular-translate's
default interpolation, to have all the cool features and at the same time, we need
MessageFormat interpolation to have full featured pluralization support.</p>

<h3 id="overridinginterpolationtemporarily">Overriding interpolation temporarily</h4>

<p>Since its a bit silly to re-implement MessageFormat's functionality within
angular-translate, we can't really use both interpolation types in a single translation.
What we <em>can</em> do, is to use one interpolation type generally application-wide
and other interpolation types in specific cases. This means you would say for example:
"<em>Please use default interpolation for all of my translations, except for translation
A, B and C</em>".</p>

<p>With that construct you're able to use all the cool features Angular provides
with it's interpolation service and in addition you can use MessageFormat interpolation
for translation id's that contain pluralization.</p>

<p>So how do we get this working? It's easy. Seriously. Once you have installed
MessageFormat and the MessageFormat interpolation service, you actually have
everything you need. All you have to do, is not to say you want to use
MessageFormat interpolation for all of your translations, but for specific translations.</p>

<p>We remove the <code>$translateProvider.useMessageFormatInterpolation()</code>. Now our app
uses default interpolation again. Allright. Next, we have to make MessageFormat
interpolation available as optional interpolation type. <code>$translateProvider</code>
has a method <code>addInterpolation()</code> which expects a factory name for an interpolation
service as first argument.</p>

<p>Let's add MessageFormat interpolation service as 'optional' interpolation type:</p>

<pre class="prettyprint linenums">
$translateProvider.addInterpolation('$translateMessageFormatInterpolation');
</pre>

<p>Okay, our app now knows, that it has to use default interpolation, but is also aware
that there's another interpolation service that could be used for specific
translations. We setup a new translation table with translations that use default
interpolation and MessageFormat interpolation:</p>

<pre class="prettyprint linenums">
$translateProvider.translations('en', {
  HEADLINE: 'I\'m a headline',
  TEXT: 'I\'m using default interpolation {{ val + val }}',
  PLURAL: '{GENDER, select, male{He} female{She} other{They}} liked this.'
});
</pre>

<p>Okay, our translation table now contains translations that use either default
interpolation or MessageFormat interpolation. Now, to tell angular-translate
which interpolation type to use when using <code>$translate</code> service to translate or
translations, we can pass an additional parameter to angular-translate's components.</p>

<p><code>$translate</code> service, expects an interpolation type as third argument. If you want
to tell <code>$translate</code> service to use MessageFormat interpolation for the given
translation id, you have to pass <code>messageformat</code> as interpolation type, like this:</p>

<pre class="prettyprint linenums">
$translate('TEXT', { val: 5 });
// "I'm using default interpolation 10"

$translate('PLURAL', { GENDER: 'male' }, 'messageformat');
// "He liked this."
</pre>

<p>We can do the same with <code>translate</code> filter. Again, the third argument an
identifier for the interpolation service:</p>

<pre class="prettyprint linenums">
{{ 'TEXT' | translate:"{ val: 5 }" }}
// "I'm using default interpolation 10"
{{ 'PLURAL' | translate:"{ GENDER: 'male' }":"messageformat" }}
// "He liked this."
</pre>

<p><code>translate</code> directive expects a new attribute called <code>translate-interpolation</code>
with which you can control the used interpolation service for a specific
translation id:</p>

<pre class="prettyprint linenums">
&lt;ANY
  translate="TEXT"
  translate-values="{ val: 5 }"&gt;&lt;/ANY&gt;
// "I'm using default interpolation 10"

&lt;ANY
  translate="PLURAL"
  translate-values="{ GENDER: 'male' }"
  translate-interpolation="messageformat"&gt;&lt;/ANY&gt;
// "He liked this."
</pre>

<p>Here's a working example (note, there' also an embedded file for locale 'de'):</p>

<h3>Source</h3>
<div source-edit="myApp" source-edit-deps="angular.js script.js" source-edit-html="index.html-23" source-edit-css="" source-edit-js="script.js-22" source-edit-unit="" source-edit-scenario=""></div>
<div class="tabbable"><div class="tab-pane" title="index.html">
<pre class="prettyprint linenums" ng-set-text="index.html-23" ng-html-wrap-loaded="myApp angular.js script.js"></pre>
<script type="text/ng-template" id="index.html-23">
    
    <div ng-controller="Ctrl">
      <h2 translate="HEADLINE"></h3>
      <p translate="TEXT" translate-values="{ val: 5 }"></p>

      <p translate="PLURAL" translate-values="{ GENDER: 'other' }" translate-interpolation="messageformat"></p>

      <button ng-click="changeLanguage('de')" translate="BUTTON_LANG_DE"></button>
      <button ng-click="changeLanguage('en')" translate="BUTTON_LANG_EN"></button>
    </div>
  </script>
</div>
<div class="tab-pane" title="script.js">
<pre class="prettyprint linenums" ng-set-text="script.js-22"></pre>
<script type="text/ng-template" id="script.js-22">
      var app = angular.module('myApp', ['pascalprecht.translate']);

      app.config(['$translateProvider', function ($translateProvider) {
        $translateProvider.preferredLanguage('en');
        $translateProvider.addInterpolation('$translateMessageFormatInterpolation');

        $translateProvider.translations('en', {
          HEADLINE: 'I\'m a headline',
          TEXT: 'I\'m using default interpolation {{ val + val }}',
          PLURAL: '{GENDER, select, male{He} female{She} other{They}} liked this.',
          BUTTON_LANG_EN: 'english',
          BUTTON_LANG_DE: 'german'
        });

        $translateProvider.translations('de', {
          HEADLINE: 'Ich bin eine Ãœberschrift',
          TEXT: 'Ich benutze default interpolation {{ val + val }}',
          PLURAL: '{GENDER, select, male{Er fand} female{Sie fand} other{Sie fanden}} es gut.',
          BUTTON_LANG_EN: 'englisch',
          BUTTON_LANG_DE: 'deutsch'
        });
      }]);

      app.controller('Ctrl', ['$translate', '$scope', function ($translate, $scope) {

        $scope.changeLanguage = function (langKey) {
          $translate.uses(langKey);
        };
      }]);
    </script>
</div>
</div><h3>Demo</h3>
<div class="well doc-example-live animator-container" ng-embed-app="myApp" ng-set-html="index.html-23" ng-eval-javascript="script.js-22"></div>

<p><br></p>

<hr>

<p><center>Made with unicorn &hearts; love by <a href="http://github.com/PascalPrecht">PascalPrecht</a></center></p></div>
